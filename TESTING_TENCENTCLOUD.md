# 腾讯云 DNS 功能测试指南

## 测试前准备

### 1. 准备腾讯云账号
- 注册腾讯云账号
- 在 DNSPod 中添加至少一个域名
- 获取 API 密钥（SecretId 和 SecretKey）

### 2. 启动服务
```bash
# 使用 Docker
docker-compose up -d

# 或本地运行
cd backend
go run main.go
```

## 测试步骤

### 1. 测试 Provider 列表
访问前端或调用 API：
```bash
GET http://localhost:8080/api/providers
```

预期结果：
```json
[
  {
    "name": "dynu",
    "display_name": "Dynu.com"
  },
  {
    "name": "tencentcloud",
    "display_name": "腾讯云 DNSPod"
  }
]
```

### 2. 添加腾讯云账户

在前端界面：
1. 登录系统
2. 进入"账户管理"
3. 点击"添加账户"
4. 填写信息：
   - 账户名称：测试账户
   - 提供商：腾讯云 DNSPod
   - API 密钥：`SecretId,SecretKey`（用逗号分隔）
5. 保存

### 3. 测试域名列表

添加账户后，应该能看到：
- 账户列表中显示新添加的账户
- 点击"查看域名"能看到该账户下的所有域名

### 4. 测试 DNS 记录管理

选择一个域名，进入记录管理：

#### 4.1 查看记录
- 应该能看到现有的所有 DNS 记录
- NS 记录不显示（系统管理）

#### 4.2 添加记录
测试添加以下类型的记录：
- A 记录：主机名 `test`，值 `1.2.3.4`
- AAAA 记录：主机名 `test6`，值 `2001:db8::1`
- CNAME 记录：主机名 `www`，值 `example.com`
- TXT 记录：主机名 `_verify`，值 `verification-code`
- MX 记录：主机名 `@`，值 `mail.example.com`，优先级 `10`

#### 4.3 编辑记录
- 修改记录的值
- 修改 TTL
- 保存后验证更改

#### 4.4 删除记录
- 删除测试记录
- 确认记录已被删除

### 5. 测试根域名记录

测试 @ 记录（根域名）：
- 添加 A 记录，主机名留空或填 `@`
- 添加 AAAA 记录，主机名留空或填 `@`
- 编辑和删除根域名记录

## 常见测试问题

### API 密钥格式错误
**错误信息：** "invalid API key format"

**解决方法：**
- 确保格式为 `SecretId,SecretKey`
- 中间用英文逗号分隔
- 没有多余空格

### 认证失败
**错误信息：** "AuthFailure"

**可能原因：**
1. SecretId 或 SecretKey 错误
2. 密钥已被删除或禁用
3. 子账号没有 DNSPod 权限

**解决方法：**
- 在腾讯云控制台验证密钥
- 检查子账号权限
- 重新创建密钥

### 看不到域名
**可能原因：**
1. 域名未添加到 DNSPod
2. API 权限不足
3. 域名状态异常

**解决方法：**
- 在 DNSPod 控制台确认域名存在
- 检查 API 权限配置
- 确认域名状态正常

### 记录修改不生效
**说明：**
- DNS 记录修改需要时间传播
- 通常 10 分钟内生效
- 本地 DNS 缓存可能影响

**验证方法：**
```bash
# 使用 nslookup
nslookup test.example.com 8.8.8.8

# 使用 dig
dig @8.8.8.8 test.example.com
```

## 测试检查清单

- [ ] Provider 列表包含腾讯云 DNSPod
- [ ] 能成功添加腾讯云账户
- [ ] 能查看域名列表
- [ ] 能查看 DNS 记录列表
- [ ] 能添加 A 记录
- [ ] 能添加 AAAA 记录
- [ ] 能添加 CNAME 记录
- [ ] 能添加 TXT 记录
- [ ] 能添加 MX 记录（带优先级）
- [ ] 能编辑记录
- [ ] 能删除记录
- [ ] 能管理根域名（@）记录
- [ ] 错误提示清晰明确

## 性能测试

### 响应时间
- 域名列表加载：< 2 秒
- 记录列表加载：< 2 秒
- 添加记录：< 1 秒
- 编辑记录：< 1 秒
- 删除记录：< 1 秒

### 并发测试
- 多个账户同时操作
- 同一账户多个域名同时操作
- 批量添加/删除记录

## 测试报告模板

```
测试日期：YYYY-MM-DD
测试人员：
测试环境：Docker / 本地

功能测试结果：
- Provider 列表：✅ / ❌
- 添加账户：✅ / ❌
- 域名列表：✅ / ❌
- 记录列表：✅ / ❌
- 添加记录：✅ / ❌
- 编辑记录：✅ / ❌
- 删除记录：✅ / ❌
- 根域名记录：✅ / ❌

发现的问题：
1. 
2. 

建议改进：
1. 
2. 
```

## 注意事项

1. **使用测试域名**
   - 不要在生产域名上测试
   - 使用专门的测试域名

2. **备份记录**
   - 测试前备份现有 DNS 记录
   - 测试后恢复原始配置

3. **API 限流**
   - 注意腾讯云 API 调用频率限制
   - 避免短时间内大量请求

4. **成本控制**
   - 免费版 DNSPod 有记录数量限制
   - 注意 API 调用可能产生的费用
